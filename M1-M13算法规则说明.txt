模块编号：M1
模块名称：持仓成本
统计范围：当前所有未平仓头寸（包括多头 + 空头）

规则：
- 对于多头：成本 = 买入价 × 数量
- 对于空头：成本 = 卖出价 × 数量（视为正数）

说明：
- 所有成本均为绝对值，不考虑方向性
- 该值仅代表初始建仓投入金额，用于衡量账户仓位规模，而非盈亏

示例：
- 多头：买入100股 @ $20 → 成本 = $2000
- 空头：卖空100股 @ $10 → 成本 = $1000


模块编号：M2  
模块名称：持仓市值
统计范围：当前所有未平仓头寸（多头 + 空头）

规则：
- 市值 = 当前价格 × |数量|
- 当前价格 = 实时 API 获取价格（优先）或 用户手动输入价格（备用）

说明：
- 所有市值均处理为正数，忽略多空方向
- 表示当前市场对账户所有仓位的估值总额
- 不涉及盈亏，只反映资产体量

示例：
- 多头：100 股，实时价格 $30 → 市值 $3000
- 空头：-100 股，实时价格 $20 → 市值 $2000

模块编号：M3  
模块名称：持仓浮盈
统计范围：当前所有未平仓头寸（包括历史仓位 + 当日新开仓）

规则：
- 多头：浮盈 = (当前价格 - 成本价) × 数量
- 空头：浮盈 = (成本价 - 当前价格) × 数量（数量始终为正值）

变量定义：
- 当前价格 = 实时 API 获取 或 手动输入（优先 API）
- 成本价 = 每笔未平仓头寸的建仓价格（BUY 或 SHORT）
- 数量 = 每笔未平仓头寸的实际持仓股数（正为多，负为空 → 用绝对值）

排除规则：
- 今日已平仓的部分不得计入浮盈（即当日买入并卖出的量、或卖空并已补回的量）

说明：
- 本模块衡量“当前还持有的”仓位价值变动带来的盈亏
- 用于反映未结算资金的浮动表现，不包含任何已实现交易

示例：
- 多头：成本 $20，现价 $25，数量 100 → 浮盈 = ($25-$20)×100 = $500
- 空头：成本 $30，现价 $26，数量 100 → 浮盈 = ($30-$26)×100 = $400

模块编号：M4  
模块名称：今天持仓平仓盈利
统计范围：今天平掉的“历史持仓”所产生的盈利或亏损  
（不包括今天开、今天平的日内交易）

规则：
- 多头：SELL 操作，配对的是“历史 BUY” → 盈亏 = (卖出价 - 历史买入价) × 数量
- 空头：COVER 操作，配对的是“历史 SHORT” → 盈亏 = (历史卖空价 - 回补价) × 数量

排除：
- 如果该笔 SELL / COVER 对应的是今天开仓的 BUY / SHORT，则不计入此模块 → 归 M5

变量定义：
- 成交价：当前平仓操作价格（SELL 或 COVER）
- 成本价：来自历史仓位记录（BUY 或 SHORT）
- 数量：实际配对成功的数量（按 FIFO 原则）

说明：
- 本模块用于统计“今天平掉的老仓位”所带来的已实现盈亏
- 它不关心浮盈，也不关心今天开今天平，只关注今天“清掉老仓”赚了多少

示例：
- 7月8日买入 100 股 @ $20，7月9日卖出 @ $24 → 盈利 $400，记入此模块
- 今天买入 100 股，今天卖出 → 不计入此模块，属于 M5

模块编号：M5
📛 模块名称：今日日内交易盈利
📌 类型：组合统计模块（显示两个子值：M5.1 和 M5.2）
🧠 GPT 指令说明（开发者请严格遵守）
你需要计算“今日日内交易盈利”模块，并显示两个数值：
M5.1（交易视角）：用于衡量用户今天进行了多少“开仓 + 平仓闭环”的操作，以及这些操作带来了多少盈亏；
M5.2（FIFO视角）：在上述交易行为中，这些操作所带来的账户真实已实现盈亏（基于 FIFO 成本）。

🔍 什么是“今日日内交易”
“日内交易”定义为：用户在 同一天内对同一标的进行了开仓 + 平仓 的一对操作。支持方向包括：
BUY + SELL（多头）
SHORT + COVER（空头）
不要求全部成交匹配，只要有闭环部分，即可按部分处理。

🧮 M5.1 计算步骤（交易视角）
读取当天所有交易，按时间顺序排列；
分方向（多头/空头）维护两个行为栈（BUY 栈 / SHORT 栈）；
每当出现反向操作（SELL 或 COVER）时，从对应行为栈中 FIFO 匹配开仓记录；
每次成功配对，计算行为盈亏 = (平仓价 − 开仓价) × 数量；
将所有成功配对的盈亏加总，得到 M5.1。

🧮 M5.2 计算步骤（FIFO视角）
对所有 M5.1 中“配对成功”的成交对，重新查找对应成本：
SELL → 使用历史 FIFO BUY 成本
COVER → 使用历史 FIFO SHORT 成本
重新计算真实盈亏 = (平仓价 − FIFO 成本) × 数量；
汇总得到 M5.2。

✅ 输出格式（页面渲染建议）
makefile
M5 今日日内交易盈利
交易视角：$+320.00
FIFO视角：$+170.00

📊 示例验证（GPT必须理解以下场景）
示例：
假设用户持有：
历史持仓：100股 TSLA @ $90（BUY）
今日操作如下：
09:30 BUY 50股 TSLA @ $95
10:00 SELL 100股 TSLA @ $105
分析：
第一部分 SELL（50股） → 可与今日 BUY @95 匹配，计入 M5（行为视角闭环）
第二部分 SELL（剩余50股）→ FIFO 与历史 BUY @90 匹配，计入 M4
M5 结果应为：
M5.1 = ($105 - $95) × 50 = $500
M5.2 = ($105 - $90) × 50 = $750

❗注意事项
同一天买入但未卖出，不构成日内 → 不计入 M5；
一笔 SELL 可能拆分为部分计入 M5，剩余部分进入 M4；
成本拆分必须严格 FIFO，不得平均成本或整体估值；
每笔交易视为独立单位，允许部分成交；
模块渲染必须双值并列输出，不可覆盖、合并、错位。

✅ M6 模块标准定义（GPT技术可读格式）
模块编号：M6
模块名称：今日总盈利变化
类型：每日浮动值汇总模块（已实现 + 浮动盈亏）
📐 模块目的：
反映账户在当前交易日内的整体盈亏变动，综合“今天已平仓”+“目前仍持有的浮盈”部分。
📊 组成结构（两个子来源模块）
M6 = M4 + M3（仅限今日范围内）
M4：今天持仓平仓盈利（已实现的）
M3：持仓浮盈（浮动的，未平仓头寸按实时价格波动）
注意：M5 不计入本模块，因为它已被拆入行为统计维度，不代表实际账户结算值。

🧮 计算逻辑
读取当日所有交易（含历史持仓）；
计算 M4：今天卖出历史仓位所产生的真实 FIFO 盈亏；
计算 M3：目前持有仓位根据今日价格与成本之间的差额（浮盈）；
将上述两个值相加，作为 M6 输出。

📘 示例：
假设：
您原持仓：100 股 TSLA @ $90
今天：SELL 50 股 @ $100，BUY 50 股 @ $95
实时价格为 $105
分析：
M4：50 股老仓卖出 → ($100 - $90) × 50 = $500
M3：当前持有（50老 + 50新） → 浮盈 = ($105 - $90) × 50 + ($105 - $95) × 50 = $750 + $500 = $1250
M6 = $500 + $1250 = $1750
🔍 注意事项
不含 M5 交易视角盈亏（行为统计，不代表实际收益）
浮盈使用今日实时价格计算，非昨收（昨收用于周期统计）
M3 中仅包含今日还持仓的未平部分，今日已卖出的不重复计入

✅ M7 最终显示格式定义
📛 模块名称：今日交易次数（分类统计）
📦 显示样式（单行紧凑）
B/2 S/1 P/2 C/1 【6】
含义：
B：BUY 次数
S：SELL 次数
P：SHORT（卖空）次数
C：COVER（回补）次数
【总次数】：全部加和（即今日交易总次数）
✅ 举例：
当日记录如下：
时间	标的	操作	数量
09:30	TSLA		BUY		100
10:00	TSLA		SELL		100
11:00	AAPL		SHORT	50
12:00	AAPL		COVER	50
13:00	AMZN	BUY		30
14:30	GOOGL	SHORT	70
输出为：
B/2 S/1 P/2 C/1 【6】

✅ 技术识别规则（供 GPT 使用）
所有交易记录来自 trades.json
筛选字段：date === today
按 type 字段分类计数：
B = BUY
S = SELL
P = SHORT
C = COVER
显示顺序固定为：B / S / P / C【总】

✅ 模块编号：M8
📛 模块名称：累计交易次数
📐 类型：全历史交易操作总计统计（分类）
📐 模块目的：
统计用户自账户开始记录以来（即 trades.json 中的全部交易记录），所有执行过的交易操作数量，按交易类型（B/S/P/C）分类，并输出总交易次数。

🧮 计算逻辑
遍历 trades.json 中全部记录（不限制日期）；
识别每条记录的交易类型：
B = BUY
S = SELL
P = SHORT
C = COVER
每类分别计数，最后输出总和。

🖥 显示格式（与 M7 对齐）
B/120 S/95 P/80 C/76 【371】
✅ 示例：
假设 trades.json 中的记录分布如下：
BUY：120 条
SELL：95 条
SHORT：80 条
COVER：76 条
则 M8 输出为：
B/120 S/95 P/80 C/76 【371】

❗ 注意事项：
包含所有历史交易，不限标的、不限账户、不限时间；
非交易类型记录（如分红、系统日志）不计入；
不重复统计或归类单笔合并操作，每笔记录算一次；
与 M7 结构一致，方便横向比较今日 vs. 累计。

✅ 模块编号：M9
📛 模块名称：所有历史平仓盈利
📐 类型：已实现总盈亏统计模块（历史 + 全标的）
📐 模块目的：
统计账户自记录开始以来，所有已完成平仓交易所产生的 真实盈亏总和，
包括多头和平空的所有历史交易，仅计算已平仓部分，按 FIFO 原则匹配成本。

🧮 计算逻辑（FIFO 平仓计算）
遍历 trades.json 中所有交易，按照时间排序；
使用 FIFO 成本栈机制 维护每个标的的多/空头寸；
每次 SELL（平多）或 COVER（平空）：
FIFO 弹出对应批次
盈亏 = （卖价 / 回补价 - 原始成本）× 数量
所有这类已平仓交易盈亏累计求和

💡 特别说明
多头盈亏 = (SELL 成交价 − BUY 成本价) × 成交股数
空头盈亏 = (SHORT 成交价 − COVER 成交价) × 成交股数（或反过来，按建仓价 - 平仓价）
仅计算已配对完成的交易对
BUY 未 SELL、SHORT 未 COVER → 不计入此模块
盈亏可能为正（盈利）或负（亏损）
🧾 示例（以 TSLA 为例）：
交易记录如下：
BUY 100 股 @ $100
SELL 50 股 @ $110
SELL 50 股 @ $105
BUY 50 股 @ $90（持仓中）
→ 全部 SELL 均配对 BUY（FIFO）
盈利 =
(110 - 100) × 50 = +$500
(105 - 100) × 50 = +$250
→ M9 = $750

✅ 页面显示格式（示例）：
M9 所有历史平仓盈利  
累计已实现：+$28,440.35
❗ 注意事项：
本模块统计值会随着新平仓交易而实时更新；
不含未平仓部分盈亏（即浮盈浮亏）；
不含行为视角盈利（如 M5.1）；
依赖严格 FIFO 匹配（按批次拆分计算）；
与 M4 相同算法，但 M4 仅限今天，M9 是累计历史。

✅ M10 模块显示规范
模块编号：M10  
模块名称：胜率  
显示格式：W/X L/X 胜率%
✅ 示例输出：
W/10 L/2 83.3%
W/10 → 显示为绿色文字
L/2 → 显示为红色文字
83.3% → 显示为白色文字（默认）

📐 背后计算逻辑不变（仅展示风格调整）
所有平仓记录拆批统计；
盈利 > 0 → W 计数； 盈利 < 0 → L 计数；
胜率 = W / (W + L)

✅ 模块编号：M11 / M12 / M13
📛 模块名称：
M11：WTD（本周累计盈利）
M12：MTD（本月累计盈利）
M13：YTD（本年累计盈利）

📐 模块目的：
分别统计：
本周（WTD）
本月（MTD）
本年度（YTD）
账户的 总盈亏变化（含已实现 + 浮动）

🧮 计算逻辑
✅ 1. 遍历 dailyClose.json 或 dailyResult[] 数据
该数据应记录每一交易日的盈亏结果，json结构如下：
  {
    "date": "2025-07-08",
    "realized": 120.00,        // 已实现盈亏（来自 M4）
    "unrealized": 80.00        // 浮动盈亏（来自 M3）
  },
  ...
]
✅ 2. 对每一条记录判断归属范围：
模块	起算日	包含范围
WTD	本周第一个交易日（周一）	当前交易日之前的所有记录
MTD	本月第一个交易日	当前交易日之前的所有记录
YTD	本年 1 月 1 日	当前交易日之前的所有记录
（包括今日）

✅ 3. 每个周期的累计盈亏计算方式：
累计盈亏 = ∑(每日已实现盈亏 + 浮动盈亏)
注意：统计仅包括有效交易日，无交易日跳过。

✅ 页面显示格式（样式一致）
WTD：+$1,240.00  
MTD：+$5,810.35  
YTD：+$22,735.60
正数为绿色字体
负数为红色字体
单元格默认白底黑字，仅数字部分着色

❗ 注意事项：
每日盈亏数据应由 M4 + M3 聚合生成，需在每日交易后固化；
一旦日期跨越新周 / 新月 / 新年，统计起始点自动调整；
如果某日未交易但仍有浮盈，应保留记录；
若 dailyClose.json 缺失某天，可能导致周期值低估（需设置弹出提醒用户手动补充）


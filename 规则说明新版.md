\*\*案例 A（TSLA + GOOGL）\*\*

交易记录：

2025-07-08 13:00 买入 100 股 TSLA @90

2025-07-09 09:30 买入 50 股 TSLA @95

2025-07-09 10:00 卖出 100 股 TSLA @105

2025-07-09 12:00 做空 40 股 GOOGL @1500

2025-07-09 13:30 回补 20 股 GOOGL @1480

结算价：TSLA 105，GOOGL 1490



结果与计算过程

M1 持仓成本：50×95 + 20×1500 = 4 750 + 30 000 = \*\*34 750\*\*

M2 持仓市值：50×105 + 20×1490 = 5 250 + 29 800 = \*\*35 050\*\*

M3 持仓浮盈：(105−95)×50 + (1500−1490)×20 = 500 + 200 = \*\*700\*\*

M4 今天持仓平仓盈利：(105−90)×100 = \*\*1 500\*\*

M5 今日日内交易盈利

 5.1 交易视角：(105−95)×50 + (1500−1480)×20 = 500 + 400 = \*\*900\*\*

 5.2 FIFO视角：(105−90)×100 + (1500−1480)×20 = 1 500 + 400 = \*\*1 900\*\*

M6 今日总盈利变化（今日平仓的历史仓位 + 今日当日的日内交易基于FIFO的实际情况+ 今日持仓的浮盈）：M4 + M5.2 + M3 = 4 100

M7 今日交易次数：B/1 S/1 P/1 C/1 【4】

M8 累计交易次数：B/2 S/1 P/1 C/1 【5】

M9所有历史平仓盈利（M4 + M5.2）：1 500 + 1 900 = \*\*3 400\*\*

M10 胜率：W/2 L/0 100%

M11 WTD（本周累计真实盈利） = 4 100

M12 MTD（本月累计真实盈利） = 4 100

M13 YTD（本年累计真实盈利） = 4 100



一、输入要素

1 历史持仓

昨天收盘后仍未平掉的每笔仓位，

需包含：

* 标的名称
* 方向（多头/空头）
* 数量（股数）
* 开仓价格



2 当日交易明细（按时间先后排序）

每笔交易记录需包含：

* 时间戳（YYYY-MM-DD HH:MM）
* 操作类型：买入（Buy, B）、卖出（Sell, S）、卖空（Short, P）、回补（Cover, C）
* 数量（股数）
* 成交价格



3 实时价格／当日收盘价

对于每个标的，提供当天的实时价格或收盘价，用于计算当日留仓市值与浮盈。



二、核心概念与仓位状态

* 历史持仓：指“今天开盘前”已有的仓位，其中部分或全部可能在今日被平掉。
* 今日日内交易：指“今天新开仓”并“今天全部平掉”的头寸。
* 当日留仓：指“今天新开仓”但“今天收盘前未平掉”的头寸，将被带到次日。



三、指标计算流程（M1–M13）

以下各步均可用于任意标的与任意交易明细。

模块编号：M1

模块名称：持仓成本

统计范围：所有“当日留仓”头寸（包括多头和空头）

规则：

多头头寸成本 = 买入价 × 剩余数量

空头头寸成本 = 卖空价 × 剩余数量（视为正数）

说明：

仅统计“今天新开且未平”或“昨日留存且未平”部分的成本，不包含今日已平部分。

该值反映当前持仓的初始投入规模，用于后续市值和浮盈计算。

示例（案例 A）：

TSLA：50 股 @95 → 95×50 = 4 750

GOOGL（空头）：20 股 @1500 → 1500×20 = 30 000

M1 = 4 750 + 30 000 = 34 750



模块编号：M2

模块名称：持仓市值

统计范围：所有“当日留仓”头寸

规则：

多头市值 = 实时价格 × 剩余数量

空头市值 = 实时价格 × 剩余数量（取绝对值）

说明：

实时价格可由行情 API 获取或收盘价手动输入。

该值反映当前市场对未平仓头寸的估值总额，不含任何已实现盈亏。

示例（案例 A）：

TSLA：50 股 @105 → 105×50 = 5 250

GOOGL：20 股 @1490 → 1490×20 = 29 800

M2 = 5 250 + 29 800 = 35 050



模块编号：M3 （M2-M1)

模块名称：持仓浮盈

统计范围：所有“当日留仓”头寸

规则：

多头浮盈 = (实时价格 − 成本价) × 剩余数量

空头浮盈 = (开仓价 − 实时价格) × 剩余数量

说明：

可直接用 M2−M1 计算；

仅包含未平仓头寸的浮动盈亏，不含任何已实现部分。

示例（案例 A）：

TSLA： (105−95)×50 = 500

GOOGL： (1500−1490)×20 = 200

M3 = 500 + 200 = 700



模块编号：M4

模块名称：历史的持仓平仓盈利

统计范围：今日“平掉”的所有历史持仓（开仓日<今天）

规则：

多头平仓盈利 = 卖出价 − 原始买入价

空头平仓盈利 = 原始卖空价 − 回补价

盈亏 = （平仓价 − 开仓价）× 数量（方向已在公式中体现）

排除：

对应的 SELL/COVER 如果是“今日新开”，则不计入本模块

说明：

统计来源于“昨日及更早”持仓今天被平掉的部分，实现的真实盈亏。

示例（案例 A）：

卖出 100 股 TSLA，配对昨日 100 股 @90 → (105−90)×100 = 1 500

M4 = 1 500



模块编号：M5

模块名称：今日日内交易盈利

类型：组合模块，含 M5.1（交易视角）与 M5.2（FIFO 视角）

M5.1 交易视角

统计范围：所有“今日新开”的头寸

规则：对“今日新开且已平”的部分，按（平仓价 − 开仓价） × 数量，计算已实现盈亏；

对”今天开仓但到收盘还没平掉的头寸“先算出当前的未实现盈亏：（当前价格 − 当时开仓价格）× 剩余股数

以上2者相加，得到 M5.1 的总和。

M5.2 FIFO 视角

规则：取所有“今日平仓”记录，按先入先出匹配开仓（不论开仓日）；

每笔配对盈亏 =（平仓价 − 对应开仓价）× 数量；

所有配对盈亏之和即 FIFO 视角。M5.2.

说明：

M5.1 适合盘中监控；M5.2 为会计或税务口径，也是 M6 的日内部分。

一笔 SELL/COVER 可拆分至两模块：配对“今日新开”→ M5，剩余“历史持仓”→ M4。

示例（案例 A）：

5.1 = (105−95)×50 + (1500−1480)×20 = 500 + 400 = 900

5.2 = (105−90)×100 + (1500−1480)×20 = 1 500 + 400 = 1 900

模块编号：M6

模块名称：今日总盈利变化

统计范围：当日全部已实现盈亏（包括历史仓平仓＋日内 FIFO 平仓）和当日持仓的浮盈亏

规则：M6 = M4 + M5.2 + M3

M4：今日平历史仓盈亏（今日平掉的“历史持仓”所实现盈亏）

M5.2：今日日内交易（FIFO 视角）所实现盈亏

M3：当日持仓的浮盈亏

说明：

综合反映账户当天的净收益变化，可正可负。

与 M5.1（行为视角）无关，以避免重复计入。



示例（案例 A）：

M4 = 1 500

M5.2 = 1 900

M3 =   700

M6 = 1 500 + 1 900 + 700 = 4 100



模块编号：M7

模块名称：今日交易次数

统计范围：今天所有交易

规则：

B = Buy（买入）

S = Sell（卖出）

P = Short（卖空）

C = Cover（回补）

显示格式：B/x S/y P/z C/w 【总次数】

说明：

每条交易记录计一次。



示例（案例 A）：

B/1 S/1 P/1 C/1 【4】



模块编号：M7

模块名称：今日交易次数

统计范围：今天所有交易（按 FIFO 配对后的成交批次数）

规则：

对每笔 买入（B）或 卖空（P）指令，计为 1 次交易。

对每笔 卖出（S）或 回补（C）指令：

按 FIFO 原则，将成交数量拆分匹配到最早的持仓批次；

每匹配成功一次（即每一批次被平掉），计 1 次交易；

如果一个指令平掉了多于一批持仓，则按批次数累加。

显示格式：B/x S/y P/z C/w 【总次数】

其中，y 和 w 分别是拆分后所有 S 和 C 批次数之和。
买入和卖空不拆批，一条指令始终算 1 次。
示例（基于FIFO）：

09:00 BUY 10 股 @10 → B/1

10:00 BUY 10 股 @9 → B/1

11:00 SELL 20 股 @11

首先平掉 10 股成本 10 → S 批次 1

再平掉 10 股成本 9 → S 批次 2

→ S/2



模块编号：M8

模块名称：累计交易次数

统计范围：账户自开始以来每日交易次数累积，按纽约时间的真实日期排列。
规则：M8 = Σ（各交易日的 M7）  先按每天计算出 M7（今日交易次数），再将过去所有交易日的 M7 累加，得到当前的累计交易次数。

显示格式：B/x S/y P/z C/w 【总次数】
其中的 x、y、z、w 分别是各日 B/S/P/C 笔数之和；

【总次数】即 Σ M7。

说明：

直接以“天”为单位累加，避免对单笔指令拆批；

能更直观地对比每天的交易活跃度与历史整体活跃度



模块编号：M9

模块名称：所有历史平仓盈利

统计范围：账户自开仓以来所有已平仓头寸

规则：M9 = Σ（所有历史及今日平仓盈亏），等同于 M4 + M5.2（仅今日）+先前每日 M5.2 累计

本日部分：M4 + M5.2

往日部分：先前每日 M5.2 历史累计

示例（案例 A，仅含今日）：

M9 = 1 500 + 1 900 = 3 400



模块编号：M10

模块名称：胜率

统计范围：账户有记录以来所有已平仓交易（基于 FIFO 配对后的结果）

规则：

先按 FIFO 原则配对：

多头：每次 SELL（卖出）与最早未平的 BUY（买入）配对；

空头：每次 COVER（回补）与最早未平的 SHORT（卖空）配对。

对每一次 FIFO 配对 计算盈亏：

多头配对盈亏 = 平仓价 − 对应开仓价

空头配对盈亏 = 对应开仓价 − 回补价

统计配对结果：

W = 盈利配对次数（盈亏 > 0）

L = 亏损配对次数（盈亏 < 0）

计算胜率：

胜率 = W ÷ (W + L) × 100%

说明：

本模块仅使用 M5.2（FIFO 视角）中的配对逻辑，不包含 M5.1 的“行为视角”统计；

每一笔配对都严格按照先进先出的方式匹配成本，确保历史成本准确对应到每次平仓。

示例（案例 A，仅含今日配对）：

配对 1：TSLA 100 股 @90 → 卖出 @105，盈利 → W+1

配对 2：GOOGL 20 股 @1500 → 回补 @1480，盈利 → W+1

无亏损配对 → L=0

输出：W/2 L/0 100%



模块编号：M11

模块名称：WTD（本周累计真实盈利）

统计范围：本周全部交易日

规则：M11 = 本周每日 M6 之和，周一至当日。



模块编号：M12

模块名称：MTD（本月累计真实盈利）

统计范围：本月全部交易日

规则：M12 = 本月每日 M6 之和（每月1日至每月31日）



模块编号：M13

模块名称：YTD（本年累计真实盈利）

统计范围：本年度全部交易日

规则：M13 = 本年每日 M6 之和（每年1月1日至每年12月31日）

